<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
    <script src="https://cdn.bootcss.com/showdown/1.3.0/showdown.js"></script>
    <script>
        var updateWeather=function() {
            $.ajaxSettings.async = false;
            $.getJSON("http://api.map.baidu.com/telematics/v3/weather?location=%E5%A4%A7%E8%BF%9E&output=json&ak=GOcC6xATGeCEsGGc1S5dAOVRtkXrTwN4&callback=?",function(json){           
            document.getElementById("learn").value='##'+json.date+'\n'+
                                                   '##'+json["results"][0]["weather_data"][0]["temperature"]+" "+json["results"][0]["weather_data"][0]["weather"]+ " " +json["results"][0]["weather_data"][0]["wind"]+'\n'+
                                                   '##锻炼\n'+
                                                   '##番茄\n'+
                                                   '##支出\n';
        });
        }
        var updateBooklist=function() {
            $.getJSON("https://api.douban.com/v2/book/user/34262520/collections?status=reading&callback=?",function(json){
                bookName = json.collections[0].book.title;
                bookNum = json.total;
                for (var i=0;i<=bookNum;i++) {
                    var bookList = document.getElementById("bookList");
                    bookList.options.add(new Option(json.collections[i].book.title, json.collections[i].book.title))
                }
            });
        }
        function findMyDom(str,dom){
            a=$("#result h2");
            for(var i =0;i<$("#result h2").length;i++){
                if(a[0].innerText == str){
                    $(dom).val(a.next()[0].innerText);
                    break;
                }
                else{
                    a=a.next();
                }
            }
            return 1;
        }
        function findAll(){
            findMyDom("锻炼","#sport");
            findMyDom("支出","#zhichu");
            findMyDom("番茄","#tomato");
            return 1;
        }        
        window.onload=function() {
            updateWeather();
        }
    </script>    
    <style>
        body
        {
        background-color: #F9F9F5;
        margin: 0;
        padding:0;
        border:0
        }
        body {
        font-family: "Microsoft YaHei",微软雅黑,"MicrosoftJhengHei",华文细黑,STHeiti,MingLiu;
        font-size: 14px;
        line-height: 1.42857143;
        }
        textarea{
        height:80%;
        width:49%;
        }      
        div,textarea{
        float:left;
        display:inline;
        }
        #send{
        background:red;
        color:#fff;
        width:150px;
        height:30px;
        font:14px Verdana, Arial, Helvetica, sans-serif;         
        }
    </style>
</head>
<body>
    <form id="form" action="save.php" method="post">
        <label for="zhichu"></label><input type="hidden" name="txt" id="txt" />
        <label for="tomato"></label><input type="hidden" name="tomato" id="tomato" />
        <label for="sport"></label><input type="hidden" name="sport" id="sport" />
        <input type="submit" name="send" id="send" value="提交" onclick="findAll()" /></p>
        <label for="learn"></label><textarea name="learn" cols="20" rows="5" id="learn" onkeyup="compile()"></textarea>       
        <div id="result"></div>
        <script type="text/javascript">
            function compile(){
              var text = document.getElementById("learn").value;
              var converter = new showdown.Converter();
              var html = converter.makeHtml(text);
              document.getElementById("result").innerHTML = html;
            }
        </script>        
    </form>
</body>
