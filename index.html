<?php
?>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>我的日记</title>
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
    <script src="https://cdn.bootcss.com/showdown/1.3.0/showdown.js"></script>
    <script>
var updateWeather=function(){$.ajaxSettings.async=false;$.getJSON("http://api.map.baidu.com/telematics/v3/weather?location=%E5%A4%A7%E8%BF%9E&output=json&ak=GOcC6xATGeCEsGGc1S5dAOVRtkXrTwN4&callback=?",function(c){document.getElementById("content").value="##"+c.date+"\n##"+c.results[0]["weather_data"][0]["temperature"]+" "+c.results[0]["weather_data"][0]["weather"]+" "+c.results[0]["weather_data"][0]["wind"]+"\n##锻炼\n##番茄\n##支出\n##闲情\n"})};var updateBooklist=function(){$.getJSON("https://api.douban.com/v2/book/user/34262520/collections?status=reading&callback=?",function(d){bookName=d.collections[0].book.title;bookNum=d.total;for(var c=0;c<=bookNum;c++){var e=document.getElementById("bookList");e.options.add(new Option(d.collections[c].book.title,d.collections[c].book.title))}})};function findAll(){a=$("#-1");b=$("#-2");if(a.prev().text()!="锻炼"){$("#sport").val(a.prev().text())}if(a.next().text()!="支出"){$("#tomato").val(a.next().text())}$("#zhichu").val(b.next().text());window.location.reload()}window.onload=function(){updateWeather()};
    </script>    
    <style>
body{background-color:#f9f9f5;padding:0;border:0}body{font-family:"Microsoft YaHei",微软雅黑,"MicrosoftJhengHei",华文细黑,STHeiti,MingLiu;font-size:14px;line-height:1.42857143}div,textarea{height:95%;width:49%;display:inline;whit-space:nowrap;float:left;}textarea{font-family:"Microsoft YaHei",微软雅黑,"MicrosoftJhengHei",华文细黑,STHeiti,MingLiu;font-size:18px;line-height:1.42857143;}div{margin-right:1%;margin-left:1%;word-wrap:break-word;}#counter{font-family:"Microsoft YaHei",微软雅黑,"MicrosoftJhengHei",华文细黑,STHeiti,MingLiu;font-size:18px;line-height:1.42857143}#send{background:red;color:#fff;width:150px;height:30px;font:14px Verdana,Arial,Helvetica,sans-serif}
    </style>
</head>
<body>
    <form id="form" action="save.php" method="post" target="hidden_frame">
        <label for="zhichu"></label><input type="hidden" name="zhichu" id="zhichu" value=""/>
        <label for="tomato"></label><input type="hidden" name="tomato" id="tomato" value=""/>
        <label for="sport"></label><input type="hidden" name="sport" id="sport" value=""/>
        <p><input type="submit" name="send" id="send" value="提交" onclick="findAll()" />  
        已经输入<span id="counter">0</span>字</p>
        <label for="content"></label><textarea name="content" id="content" onkeyup="compile()" onkeydown="countChar('content','counter')"></textarea>       
        <div id="result"></div>     
        <iframe name='hidden_frame' id='hidden_frame'  style="display:none;">
            <script language=JavaScript>   
               parent.location.reload();   
            </script>          
        </iframe>
        <script type="text/javascript">
function compile(){var a=document.getElementById("content").value,b=new showdown.Converter,c=b.makeHtml(a);document.getElementById("result").innerHTML=c}function countChar(a,b){document.getElementById(b).innerHTML=document.getElementById(a).value.length}         
        </script>          
    </form>
</body>
